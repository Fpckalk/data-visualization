<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Mordor</title>
	<!-- Thanks D3, you tha man -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false"></script>
	<style>
		* { box-sizing: border-box; }
		html,
		body {
			background-color: #222222;
			margin: 0;
			height: 100%;
			width: 100%;
			color: #ebe0d8;
		}
		header {
			background: url('http://school.fpck.nl/dv/header.jpg') 0 0 no-repeat;
			background-size: 100%;
			height: 20%;
			padding: 2em 0;
			box-shadow: 0 0 20px #080808;
			position: relative;
			z-index: 1;
		}
			header * {
				max-width: 960px;
				display: block;
				margin: 0 auto;
				text-align: center;
			}
				header input[type="checkbox"] { display: inline-block; }
			header h1 {
				text-align: center;
				font-size: 3em;
				margin-bottom: .5em;
			}
		#map {
			margin: 0;
			width: 100%;
			height: 80%;
		}

		.SvgOverlay {
		    position: relative;
		}

		.SvgOverlay svg {
		    position: absolute;
		    top: -4000px;
		    left: -4000px;
		    width: 8000px;
		    height: 8000px;
		}

		.iris,
		.tower { fill: #111111; }
		.eye { fill: #d95921; }
	</style>
</head>
<body>
	<header>
		<h1>Mordor</h1>

		<span>Opacity</span>
		<input type="range" max="99" value="90" step="10" onchange="changeOpacity(this)">

		<label>
			<input type="checkbox" unchecked onchange="showSelfie(this)">
			Selfie
		</label>
	</header>

	<figure id="map"></figure>

	<script>

		// Kinda rewrote the code to my liking

		'use strict';

		var	MAGIC_SIZE = 4000;
		var map = document.querySelector('#map');
		var data = {
		    "type": "FeatureCollection",
		    "features": [
		        {
		            "type": "Feature",
		            "properties": {
		                "name": "eye",
		                "time": "2014-11-30T11:18:21.347Z"
		            },
		            "geometry": {
		                "type": "Polygon",
		                "coordinates": [[[4.75529, 52.630398, 57.9 ], [4.755338, 52.630531, 59.1 ], [4.75549, 52.630608, 60.8 ], [4.755511, 52.630703, 62.8 ], [4.755559, 52.630825, 61.8 ], [4.755098, 52.630985, 50.8 ], [4.754714, 52.631092, 47.9 ], [4.75459, 52.631145, 44.7 ], [4.754611, 52.63126, 39.5 ], [4.754488, 52.631317, 38.5 ], [4.754366, 52.631413, 37 ], [4.754216, 52.631454, 35.6 ], [4.754051, 52.631477, 37.9 ], [4.753893, 52.631496, 38.4 ], [4.753784, 52.631618, 40.3 ], [4.753706, 52.631725, 41.4 ], [4.753592, 52.631794, 40.9 ], [4.753413, 52.631866, 40 ], [4.753232, 52.631863, 39.9 ], [4.753069, 52.631882, 40 ], [4.752984, 52.631958, 43.3 ], [4.752863, 52.632015, 43.6 ], [4.752691, 52.632027, 42.9 ], [4.752533, 52.632061, 41.6 ], [4.752365, 52.632118, 40.2 ], [4.752205, 52.632133, 42.4 ], [4.752026, 52.632133, 40.8 ], [4.751811, 52.63224, 40.6 ], [4.7517, 52.632339, 41.1 ], [4.751635, 52.632427, 38.4 ], [4.75147, 52.632347, 40.6 ], [4.751311, 52.632305, 42.4 ], [4.751123, 52.63232, 48.1 ], [4.750935, 52.632332, 47.1 ], [4.750798, 52.632385, 48.6 ], [4.750792, 52.632481, 48.8 ], [4.750826, 52.632389, 51.1 ], [4.750811, 52.632298, 49.7 ], [4.750784, 52.632202, 48.7 ], [4.750771, 52.632103, 48.1 ], [4.750671, 52.632034, 47 ], [4.750501, 52.632019, 45.8 ], [4.750643, 52.631966, 43.1 ], [4.750817, 52.631821, 43.4 ], [4.750944, 52.631756, 44 ], [4.750947, 52.631634, 43.7 ], [4.750995, 52.631512, 34.8 ], [4.750938, 52.631413, 34.8 ], [4.750873, 52.631279, 33.4 ], [4.751071, 52.631275, 32.2 ], [4.751231, 52.631256, 30.5 ], [4.751335, 52.631161, 32.7 ], [4.75146, 52.631054, 37.8 ], [4.751654, 52.631031, 37.6 ], [4.751842, 52.630951, 41.6 ], [4.752008, 52.630875, 44.3 ], [4.752252, 52.630844, 41.2 ], [4.752456, 52.630791, 44 ], [4.752666, 52.630688, 54.4 ], [4.752951, 52.6306, 53.8 ], [4.753148, 52.630585, 51.7 ], [4.753361, 52.630577, 50 ], [4.753569, 52.630524, 48.2 ], [4.753891, 52.630447, 44.8 ], [4.754051, 52.630409, 44.8 ], [4.754347, 52.630325, 38.9 ], [4.754513, 52.630341, 30.9 ]]]
		            }
		        },
		        {
		        	"type": "Feature",
		        	"properties": {
		        	    "name": "iris",
		        	    "time": "2014-11-28T19:35:22.528Z"
		        	},
		        	"geometry": {
		        	    "type": "Polygon",
		        	    "coordinates": [[[4.751853, 52.630867, 73.7 ], [4.751682, 52.630867, 31.5 ], [4.751793, 52.630932, 42.9 ], [4.752106, 52.631165, 46.8 ], [4.752193, 52.631298, 45.1 ], [4.752222, 52.631401, 45.3 ], [4.752245, 52.631508, 42.9 ], [4.75229, 52.631611, 40.3 ], [4.752331, 52.631718, 39.8 ], [4.752502, 52.63195, 40.4 ], [4.752759, 52.632381, 79.9 ], [4.752614, 52.632179, 52.1 ], [4.752411, 52.632122, 23.2 ], [4.752115, 52.631958, 42.4 ], [4.751991, 52.631531, 45 ], [4.751854, 52.631149, 50.2 ], [4.751729, 52.630909, 5.9 ]]]
		        	}
		        },
		        {
			            "type": "Feature",
			            "properties": {
			                "name": "tower",
			                "time": "2014-11-30T11:48:47.233Z"
			            },
			            "geometry": {
			                "type": "Polygon",
			                "coordinates": [[[4.747675, 52.630287, 48.6 ], [4.747748, 52.630184, 49.4 ], [4.747823, 52.630093, 47.9 ], [4.747976, 52.630116, 47.9 ], [4.747903, 52.630341, 48.7 ], [4.747938, 52.630436, 49.6 ], [4.748099, 52.630527, 48.3 ], [4.74817, 52.630627, 48.2 ], [4.748149, 52.63073, 47.6 ], [4.748237, 52.630936, 46.1 ], [4.748337, 52.631027, 47.2 ], [4.748511, 52.631039, 49.7 ], [4.748662, 52.6311, 46.5 ], [4.748775, 52.631176, 47.1 ], [4.748837, 52.631317, 47.1 ], [4.748929, 52.631409, 46.2 ], [4.749002, 52.631493, 48.6 ], [4.74906, 52.63158, 50.4 ], [4.749075, 52.631485, 55.6 ], [4.74923, 52.631512, 55 ], [4.749323, 52.631603, 53.5 ], [4.749558, 52.631676, 54.8 ], [4.749686, 52.631947, 52.2 ], [4.749674, 52.632042, 49 ], [4.749741, 52.632141, 49.7 ], [4.749866, 52.632202, 37.1 ], [4.74993, 52.63229, 39.1 ], [4.749942, 52.632385, 39.2 ], [4.750097, 52.632416, 40.6 ], [4.750261, 52.63242, 35 ], [4.750413, 52.632404, 33.7 ], [4.750548, 52.632366, 32.7 ], [4.750639, 52.632435, 33.4 ], [4.751068, 52.632832, 48 ], [4.751188, 52.632919, 57.1 ], [4.751284, 52.632992, 61.6 ], [4.751266, 52.6329, 60.6 ], [4.751252, 52.63279, 58.1 ], [4.751244, 52.632683, 57.3 ], [4.751258, 52.632591, 49.1 ], [4.751191, 52.6325, 43.3 ], [4.751142, 52.632404, 45.2 ], [4.751052, 52.63224, 45.7 ], [4.75097, 52.632072, 45.7 ], [4.750927, 52.631985, 47.7 ], [4.7509, 52.631897, 51.7 ], [4.750844, 52.631794, 53.9 ], [4.750774, 52.631714, 57.1 ], [4.750525, 52.631817, 84.5 ], [4.750782, 52.631744, 55.1 ], [4.750734, 52.631634, 42.5 ], [4.750672, 52.631527, 40.4 ], [4.750596, 52.631393, 39.2 ], [4.750449, 52.631241, 38.6 ], [4.750409, 52.631153, 37.3 ], [4.750376, 52.631031, 38 ], [4.750308, 52.630947, 31.8 ], [4.7502, 52.630829, 28.7 ], [4.750134, 52.630745, 28.1 ], [4.750033, 52.630661, 28.7 ], [4.749999, 52.630505, 29.3 ], [4.749925, 52.630417, 29.8 ], [4.749844, 52.630299, 29.1 ], [4.749943, 52.630207, 30.1 ], [4.750006, 52.630112, 27.3 ], [4.750006, 52.63002, 27.3 ], [4.750152, 52.629982, 33.7 ], [4.750302, 52.629978, 34 ], [4.750415, 52.629902, 37.6 ], [4.75055, 52.629852, 38.8 ], [4.750698, 52.629814, 38.4 ], [4.750849, 52.629772, 37.4 ], [4.750991, 52.629742, 32.8 ], [4.751122, 52.629677, 34.2 ], [4.751286, 52.629555, 40.9 ], [4.751437, 52.629532, 35.1 ], [4.751561, 52.629478, 37.3 ], [4.751711, 52.629444, 35.7 ], [4.752, 52.629433, 43 ], [4.752153, 52.629383, 43.9 ], [4.752404, 52.629307, 39.5 ], [4.752641, 52.629227, 34 ], [4.752935, 52.629196, 27.3 ], [4.753089, 52.629108, 28.5 ], [4.753124, 52.629021, 29 ], [4.753185, 52.629124, 27.3 ], [4.753212, 52.629234, 27.6 ], [4.753267, 52.629402, 28.2 ], [4.753343, 52.629513, 28.4 ], [4.753444, 52.629589, 30.7 ], [4.753421, 52.629726, 35.5 ], [4.753549, 52.629871, 36.6 ], [4.75362, 52.62999, 36.4 ], [4.753716, 52.630062, 37.2 ], [4.753868, 52.63015, 44.1 ], [4.753949, 52.630287, 50.4 ], [4.753963, 52.630383, 51 ], [4.754092, 52.630436, 49.3 ], [4.75435, 52.63039, 40.5 ], [4.754665, 52.630325, 39.8 ], [4.754799, 52.630421, 39.6 ], [4.754767, 52.630508, 38.1 ], [4.75483, 52.630646, 37.6 ], [4.75495, 52.630745, 33.6 ], [4.755049, 52.630951, 33.4 ], [4.755188, 52.631008, 34.9 ], [4.75527, 52.631088, 31.6 ], [4.75527, 52.63118, 35.6 ], [4.755329, 52.631268, 38.7 ], [4.75543, 52.631351, 37.7 ], [4.75549, 52.631443, 37.3 ], [4.755582, 52.631363, 41.9 ], [4.755657, 52.63126, 47 ], [4.755778, 52.631187, 41 ], [4.755896, 52.631119, 40.4 ], [4.755981, 52.631012, 35.5 ], [4.756004, 52.630905, 34.5 ], [4.756025, 52.630783, 32.9 ], [4.756042, 52.63068, 33.7 ], [4.756056, 52.630562, 31.8 ], [4.756044, 52.630463, 32.5 ], [4.756031, 52.630363, 33.8 ], [4.755993, 52.630276, 28.7 ], [4.756046, 52.630161, 26.6 ], [4.756095, 52.63007, 27.5 ], [4.756108, 52.629963, 25.1 ], [4.756024, 52.629841, 29.1 ], [4.755931, 52.629715, 28.6 ], [4.755811, 52.62957, 25.8 ], [4.75567, 52.629456, 27.6 ], [4.755494, 52.629322, 26.8 ], [4.75538, 52.62925, 24.9 ], [4.755234, 52.629162, 20.9 ], [4.75508, 52.629013, 22.1 ], [4.754991, 52.628937, 17.7 ], [4.754913, 52.628803, 21.3 ], [4.754724, 52.628662, 18.6 ], [4.754651, 52.628571, 28 ], [4.754545, 52.628502, 34 ], [4.754564, 52.62841, 37.8 ], [4.754612, 52.628319, 32.8 ], [4.754559, 52.628223, 33.5 ], [4.754533, 52.628105, 40.8 ]]]
			            }
			        }
		    ]
		};

		var gm = new google.maps.Map(map, {
			zoom: 16,
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			center: new google.maps.LatLng(52.631814, 4.752511),
			disableDefaultUI: true,
			styles: [{"stylers":[{"hue":"#ff1a00"},{"invert_lightness":true},{"saturation":-100},{"lightness":35},{"gamma":0.5}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#46110c"}]}]
		});

		var overlay = new google.maps.OverlayView();
		overlay.onAdd = function() {
			var layer = d3.select(this.getPanes().overlayLayer).append("div").attr("class", "SvgOverlay");
			var svg = layer.append("svg")
							.attr("width", "100%")
							.attr("height", "100%");

			var adminDivisions = svg.append("g")
									.attr("class", "AdminDivisions");

			overlay.draw = function() {
				var markerOverlay = this;
				var overlayProjection = markerOverlay.getProjection();

				var googleMapProjection = function(coordinates) {
					coordinates = overlayProjection.fromLatLngToDivPixel(
						new google.maps.LatLng(coordinates[1], coordinates[0])
					);

					return [
						coordinates.x + MAGIC_SIZE,
						coordinates.y + MAGIC_SIZE
					];
				}

				var path = d3.geo.path().projection(googleMapProjection);
				adminDivisions.selectAll("path")
								.data(data.features)
								.attr("d", path)
									.enter()
									.append("svg:path")
									.attr("d", path)
									.attr("class", function(d) { return d.properties.name; });
			}
		}
		overlay.setMap(gm);


		var marker = new google.maps.Marker({
			'map': gm,
			'icon': 'http://school.fpck.nl/dv/mordor.jpg'
		})
		var point = new google.maps.LatLng( 52.631812, 4.752509 );

		// Other functions
		function changeOpacity (slider) {
			var wrapper = document.getElementsByClassName('SvgOverlay')[0];
			wrapper.style.opacity = '0.' + slider.value;
		}

		function showSelfie (checkbox) {

			if(checkbox.checked) {
				marker.setPosition(point);				
			} else {
				marker.setPosition(null);
			}

		}
	
     </script>
 </body>
 </html>